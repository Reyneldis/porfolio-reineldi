---
// src/components/GlowEffect.astro
---

<!-- Este div es el efecto de luz -->
<div class="pointer-glow"></div>

<style>
  .pointer-glow {
    position: fixed;
    top: 0;
    left: 0;
    width: 600px;
    height: 600px;
    background: radial-gradient(
      ellipse at center,
      rgba(139, 92, 246, 0.15) 0%,
      rgba(139, 92, 246, 0.08) 40%,
      transparent 70%
    );
    border-radius: 50%;
    pointer-events: none;
    opacity: 1;
    transition: opacity 0.5s ease;
    z-index: 10;
    will-change: transform; /* Optimización: Avisa al navegador que esto va a cambiar */
  }
</style>

<script>
  function initGlowEffect() {
    const glow = document.querySelector('.pointer-glow') as HTMLElement | null;
    const body = document.body;

    if (!glow) return;

    // Desactivamos el efecto en dispositivos táctiles
    if (window.matchMedia('(pointer: coarse)').matches) {
      return;
    }

    // OPTIMIZACIÓN: Usar requestAnimationFrame para evitar bloquear el hilo principal
    let rafId: number | null = null;
    let currentX = -300;
    let currentY = -300;

    const updatePosition = () => {
      glow.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;
      rafId = null;
    };

    const moveGlow = (e: MouseEvent) => {
      // Calcular la posición objetivo
      currentX = e.clientX - 300;
      currentY = e.clientY - 300;

      // Solicitar el siguiente frame si no hay uno pendiente
      if (!rafId) {
        rafId = requestAnimationFrame(updatePosition);
      }
    };

    const showGlow = () => {
      glow.style.opacity = '1';
    };

    const hideGlow = () => {
      glow.style.opacity = '0';
    };

    body.addEventListener('mouseenter', showGlow);
    body.addEventListener('mouseleave', hideGlow);
    body.addEventListener('mousemove', moveGlow);
  }

  // Ejecutar inmediatamente
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initGlowEffect);
  } else {
    initGlowEffect();
  }

  // Ejecutar después de View Transitions
  document.addEventListener('astro:page-load', initGlowEffect);
</script>
