---
// src/components/RevealOnScroll.astro
---

<div class="reveal-on-scroll-container">
  <slot />
</div>

<style>
  /* ESTADO INICIAL: La "Niebla" (Blur) + Opacidad baja */
  .reveal-on-scroll-container {
    opacity: 0.4;
    /* El filter: blur(10px) crea el efecto de espejo empañado */
    filter: blur(10px) brightness(0.8);
    transform: translateY(20px) scale(0.98);

    /* Transición suave para que se vea elegante */
    transition:
      opacity 0.8s ease-out,
      filter 0.8s ease-out,
      transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);

    /* OPTIMIZACIÓN CLAVE: Le decimos al navegador que prepare la GPU */
    will-change: transform, opacity, filter;
  }

  /* ESTADO FINAL: "Brillante" (Nítido y claro) */
  .reveal-on-scroll-container.is-revealed {
    opacity: 1;
    filter: blur(0) brightness(1); /* Quitamos la niebla */
    transform: translateY(0) scale(1);

    /* Reseteamos will-change para ahorrar batería cuando la animación termina */
    will-change: auto;
  }
</style>

<script>
  function initRevealOnScroll() {
    const containers = document.querySelectorAll('.reveal-on-scroll-container');
    if (!containers.length) return;

    const observer = new IntersectionObserver(
      entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-revealed');
            observer.unobserve(entry.target);
          }
        });
      },
      { rootMargin: '0px', threshold: 0.1 },
    );

    containers.forEach(container => observer.observe(container));
  }

  document.addEventListener('astro:page-load', initRevealOnScroll);
  if (document.readyState !== 'loading') initRevealOnScroll();
  else document.addEventListener('DOMContentLoaded', initRevealOnScroll);
</script>
